import log from 'fancy-log';
import jwt, { JwtPayload } from 'jsonwebtoken';

const PRIVATE_KEY = Buffer.from('LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcFFJQkFBS0NBUUVBczR6bkxzNUVvaUEvVmdGV0NkUGw2Mkllc2NiNG9xbVE0SFhWWkhGWGp1MTBWSkpmCkRlL3NwMlVqWVRNN0pFd3FFR3hvb1Qya3RWQlFxOUdxcGpNL1JXNGN6UStuT3BVMXY4eFh4R3NmbFh5VHM2Z3cKZlgza0xtSzFJRW9ocS9TOE9NWG5JOW5pdGMwalk5VzNxV0dUdGdJS1gzZW41ZjEyVEtxN1ZqUFBPSGJIYmNCbwp5OG8zU0Z6WlNVWjZDY1QrbjBqNzZET3ArYWRBdG9lQWdKUW1xaGJYTVFBYWdja1V6YWhXU29xcGJVSC9xa2xMCkZ6ZWdHbnI4WnVlQ0ZqWmJvaW5WdWZXaXFXWkhJeExkWXJLaWtyQjc5VjEvaWdLZkhWQWkzNkxPYzFYQUxjeDIKMmhtYVlaR0poUEVkaDd4QXBpai9WR3p1TFRoYVY1SU5oWEZWQXdJREFRQUJBb0lCQVFDSUVhWTVvSFArOGJWTgo5bUUvdldnbXhBdEM2dWtPVExiUWhEd2RqSSt3YjErVG9BR05URi9xVkFsRjVrOVJxSzdRRjNnTGllM0N3b1VBClVUcWtEWDVMbmJFUjdtVHJUcHlYSjhMenhjTC94Sk1pdWJsVndRd2w0d1FrM2trNlNaUkM2aWZLMFpxdjhEQjcKdmtFYmlpa282ODcwbm5lTklsSitzM3laVFZZakVRd0d5MG1QNGxaVXdVaU5iWm9RNzlqbTRaMndSSW1ZcWpOZgo2dXhxeWNWbUc2WXJoajF0dFI1YmU2TkZLOVhXZ25TOVlyU0RRY2t4QXduT2ViZHYxM1BzZytWaFZyWlYrbHZCCjZCMXJIZmc1WDltaE05MWJoS0J0ZGpYWUEzTHVvNTJjeEtyQXRKUE9POGRweHI4MGp4dFZEcHVES0hzZ2Jkb2MKa0FtdjdaeUJBb0dCQU5nVlUzRnJ3Zzh1TmQxM0FrVFVORWlpckl4TC8vemRLTkEzN0lEai9zWFBpRXQzV2xURwpHb0NTN00vcisrdk5sZE9pWjlTRjRaUUdpdHpaN0h2d0EveS9QT2NPQnpGKysvUWYwUXpiNklVaWlIV3dtd0IwCk04L2YyZDI0VnRkUDFvYlpHd3lnZmlrUXQ4RTc5UkVIeEZXNTFZbzRHdXozbmVGMHJ6SitKZW1qQW9HQkFOUzMKNjVGUHRBRVpIUEpJTUZCNU1SNGM0cTE1YUlVb2c5eVh1Z1FnNEUxY1BLYVlKdVYwS3FLek1RMW1wNWNXWUtuWApTWi9hMjM0NzcyaGdBV1Uxb29XZ2xzTFUreGU3bE1jTVJJZDkvOHZ3aXVSQkZRUVg0K3dnQkQ5VDdXMmcxdkRXClFOMkFnVFEyQk5XQTI1ZHFWcjA1SGZZNjkvYzBnWENEYWoyWGVsMGhBb0dBQVJXeVVvcHc4ZlNRYnFrdlNMc3IKL0FWZENtTkRTTGl2Z01RWEd0cUtKK0lQMUJrb1NlNm9xV2FUYThQS2d2ZUlQZ1M5c3JKdFhIbmY3cFhsZXdYTQpiMU5pY2VKL0pMOTNjbFZLamw3NFB0cmFob1M1Y25vaTNITktPN08yTStTQnRqR1cwaXhvRmJxd3dYYVVsMTVMCm5RYU96Ti9WT3NWUGRKZEtYZDJHUVRNQ2dZRUFxak8zUXYrNUVaL2NiMmVmY09SbmpxYWlJUmVocjlucEdCbzIKOXBLdnBuYUUrTytKUDlNaFFpbUt1Q1JKT0RUcGh6d0JadXlnNzNKWmJ2UlNhWDd1MldqUytIV2RxekdtSzFYLwpoMElqNkRSQmpiMGRhYmNMNGFVRWdQOVFYSVZ6TmlUWXBlTHFmckl5VC9yWXVXQ1dvclVPNmpQb3NGM01yQkFhCmM4bStXTUVDZ1lFQXZxamtPalIwcURQZjBJVG5CeGxuL2cxY2xJMENtUTY1SW9sd0NnRlVzQW5zcWtoZFJEN0QKVnhTbXpCRFQ0WElGcjFyMDlmWTRnV3h1TnlQT2Z2Y0NjYkMvWCt2VXI3Yk9PRDl0WGw3MmE1WDFnbkZ0UmpKUQp1VmhWd1owMFdLSFhhbWpRNW80K1hvT3lvSTVZN29HK2tkZ3pBNFNyeFdxR0hCUnArU1d5eDFNPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQ==', "base64").toString('ascii');
const PUBLIC_KEY = Buffer.from("LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUFzNHpuTHM1RW9pQS9WZ0ZXQ2RQbAo2Mkllc2NiNG9xbVE0SFhWWkhGWGp1MTBWSkpmRGUvc3AyVWpZVE03SkV3cUVHeG9vVDJrdFZCUXE5R3Fwak0vClJXNGN6UStuT3BVMXY4eFh4R3NmbFh5VHM2Z3dmWDNrTG1LMUlFb2hxL1M4T01Ybkk5bml0YzBqWTlXM3FXR1QKdGdJS1gzZW41ZjEyVEtxN1ZqUFBPSGJIYmNCb3k4bzNTRnpaU1VaNkNjVCtuMGo3NkRPcCthZEF0b2VBZ0pRbQpxaGJYTVFBYWdja1V6YWhXU29xcGJVSC9xa2xMRnplZ0ducjhadWVDRmpaYm9pblZ1ZldpcVdaSEl4TGRZcktpCmtyQjc5VjEvaWdLZkhWQWkzNkxPYzFYQUxjeDIyaG1hWVpHSmhQRWRoN3hBcGlqL1ZHenVMVGhhVjVJTmhYRlYKQXdJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0t", "base64").toString('ascii');

export function signJwt(object: Object, options?: jwt.SignOptions | undefined) {
    return jwt.sign({data: object}, PRIVATE_KEY, {
        ...(options && options),
        algorithm: "RS256"
    })
}

export function verifyJwt<T>(token: string): T | null {
    try {
        const decoded = jwt.verify(token, PUBLIC_KEY) as JwtPayload;
        return decoded.data as T;
    } catch(e) {
        return null;
    }
}